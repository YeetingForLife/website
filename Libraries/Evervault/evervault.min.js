var bs=Object.defineProperty;var Bs=(w,p,A)=>p in w?bs(w,p,{enumerable:!0,configurable:!0,writable:!0,value:A}):w[p]=A;var E=(w,p,A)=>(Bs(w,typeof p!="symbol"?p+"":p,A),A),Ht=(w,p,A)=>{if(!p.has(w))throw TypeError("Cannot "+A)};var c=(w,p,A)=>(Ht(w,p,"read from private field"),A?A.call(w):p.get(w)),g=(w,p,A)=>{if(p.has(w))throw TypeError("Cannot add the same private member more than once");p instanceof WeakSet?p.add(w):p.set(w,A)},y=(w,p,A,vt)=>(Ht(w,p,"write to private field"),vt?vt.call(w,A):p.set(w,A),A);var B=(w,p,A)=>(Ht(w,p,"access private method"),A);(function(w,p){typeof exports=="object"&&typeof module<"u"?module.exports=p():typeof define=="function"&&define.amd?define(p):(w=typeof globalThis<"u"?globalThis:w||self,w.Evervault=p())})(this,function(){var fe,Q,xe,M,q,st,Dn,ot,$n,at,Pn,De,Mt,lt,jn,de,Ze,Ae,$e,Se,Ne,mt,W,Y,ge,Pe,je,ut,Kn,ht,Jn,C,T,j,Z,K,ee,_,J,te,Ke,re,Je,Ge,ye,Ve,Ce,N,D,Ue,ft,Gn,dt,zn,ze,_t,Fe,Le,ne,Ie,U,ie,Te,pt,gt,Wn,We,Ye;"use strict";const w="https://keys.evervault.com",p="https://inputs.evervault.com",A="https://api.evervault.com",wt={keysUrl:w,apiUrl:A,inputsOrigin:p,componentsUrl:"https://ui-components.evervault.com"},Dt=25,Yn={cipherAlgorithm:"aes-256-gcm",keyLength:32,ivLength:12,authTagLength:128,publicHash:"sha256",versions:{NOC:"NOC",BFS:"QkTC"},header:{iss:"evervault",version:1},maxFileSizeInMB:Dt,maxFileSizeInBytes:Dt*1024*1024},Zn=i=>({...Yn,publicKey:i}),Xn={ecdhP256KeyUncompressed:"BF1/Mo85D7t/XvC3I+YYpJvP+OsSyxIbSrhtDhg1SClQ2xdoyGpXYrplO/f8AZ+7cGkUnMF3tzSfLC5Io8BuNyw=",ecdhP256Key:"Al1/Mo85D7t/XvC3I+YYpJvP+OsSyxIbSrhtDhg1SClQ",isDebugMode:!0};function $t(i,e,t,r){return{teamId:i,appId:e,encryption:Zn(r),http:{keysUrl:(t==null?void 0:t.keysUrl)??wt.keysUrl,apiUrl:(t==null?void 0:t.apiUrl)??A},components:{url:(t==null?void 0:t.componentsUrl)??wt.componentsUrl},input:{inputsOrigin:(t==null?void 0:t.inputsOrigin)??wt.inputsOrigin},debugKey:Xn}}const bt=i=>typeof i<"u"&&i!==null,Xe=i=>i!=null&&typeof i=="object"&&i instanceof Array,Qn=i=>typeof ArrayBuffer=="function"&&(i instanceof ArrayBuffer||Object.prototype.toString.call(i)==="[object ArrayBuffer]"),qn=i=>typeof i=="object",Pt=i=>bt(i)&&qn(i)&&!Xe(i)&&!Qn(i),se=i=>typeof i=="string",ei=i=>i!=null&&se(i)&&i.length===0,jt=i=>typeof i=="number",Kt=i=>typeof i=="boolean",ti=i=>i instanceof File||i instanceof Blob,Jt=i=>bt(i)&&(se(i)||jt(i)||Kt(i)),Gt=i=>Xe(i)?i.constructor.name:typeof i,zt=i=>{if(se(i))return i;if(jt(i)||Kt(i)||typeof i=="bigint"||typeof i=="function")return i.toString();throw new Error(`Cannot ensure string for ${typeof i}`)};class me extends Error{constructor(t,r){var e=(...Ss)=>{super(...Ss);E(this,"type")};t!=null&&r!=null?e(t,r):e(t),this.type=this.constructor.name}}class pe extends me{}class ri extends me{}class ni extends me{}class ii extends me{}class si extends me{}class oi extends me{}function Wt(i){let e,t=i.trim().match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:/\n?=]+)/im);return t&&([,e]=t,t=e.match(/^[^.]+\.(.+\..+)$/),t&&([,e]=t)),e}function ai(i,e=!1){if(i!=null){if(i.height)return i.height;if(e)return"80px";if(i.theme==="minimal"||i.theme==="material")return"145px"}return"180px"}const li="/v2/index.html",ci="/v2/reveal.html";function ui(i,e,t){let r="";t&&Object.keys(t).filter(l=>l!=="customStyles").forEach(l=>{const u=t[l];u!==void 0&&(r+=`&${l}=${encodeURIComponent(u)}`)});const{inputsOrigin:n}=i.input,{teamId:s,appId:o}=i;let a=n+li;return e&&(a=n+ci),`${a}?team=${s}&app=${o}${r}&mode=${e?"reveal":"inputs"}`}function Re(i){const e=i.reduce((n,s)=>n+s.length,0),t=new Uint8Array(e);let r=0;for(const n of i)t.set(n,r),r+=n.length;return t}function Qe(i){const e=new Uint8Array(i),t=e.byteLength,r=e.slice(0,1+t>>>1);return r[0]=2|e[t-1]&1,r}function hi(i){return new TextEncoder().encode(i)}function $(i){const e=i.match(/../g);if(e===null)return new Uint8Array;const t=e.map(r=>parseInt(r,16));return new Uint8Array(t)}function fi(i){return Array.from(i).map(e=>e.toString(16).padStart(2,"0")).join("")}function qe(i){const e=window.atob(i),{length:t}=e,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r}function Oe(i){const e=Array.from(i).map(t=>String.fromCharCode(t)).join("");return window.btoa(e)}function di(i){const e=Qe(qe(i)),t=Oe(new Uint8Array(e));return{ecdhP256KeyUncompressed:i,ecdhP256Key:t,isDebugMode:!1}}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2022 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const gi="[object ArrayBuffer]";class b{static isArrayBuffer(e){return Object.prototype.toString.call(e)===gi}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e).slice().buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=b.toUint8Array(e),n=b.toUint8Array(t);if(r.length!==n.byteLength)return!1;for(let s=0;s<r.length;s++)if(r[s]!==n[s])return!1;return!0}static concat(...e){if(Array.isArray(e[0])){const t=e[0];let r=0;for(const o of t)r+=o.byteLength;const n=new Uint8Array(r);let s=0;for(const o of t){const a=this.toUint8Array(o);n.set(a,s),s+=a.length}return e[1]?this.toView(n,e[1]):n.buffer}else return this.concat(e)}}class Yt{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}static toString(e){const t=b.toUint8Array(e);let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return decodeURIComponent(escape(r))}}class P{static toString(e,t=!1){const r=b.toArrayBuffer(e),n=new DataView(r);let s="";for(let o=0;o<r.byteLength;o+=2){const a=n.getUint16(o,t);s+=String.fromCharCode(a)}return s}static fromString(e,t=!1){const r=new ArrayBuffer(e.length*2),n=new DataView(r);for(let s=0;s<e.length;s++)n.setUint16(s*2,e.charCodeAt(s),t);return r}}class k{static isHex(e){return typeof e=="string"&&/^[a-z0-9]+$/i.test(e)}static isBase64(e){return typeof e=="string"&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}static isBase64Url(e){return typeof e=="string"&&/^[a-zA-Z0-9-_]+$/i.test(e)}static ToString(e,t="utf8"){const r=b.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return P.toString(r,!0);case"utf16":case"utf16be":return P.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return P.fromString(e,!0);case"utf16":case"utf16be":return P.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=b.toUint8Array(e);if(typeof btoa<"u"){const r=this.ToString(t,"binary");return btoa(r)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!k.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!k.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=k.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return Yt.fromString(e);case"utf16":case"utf16be":return P.fromString(e);case"utf16le":case"usc2":return P.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=k.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return Yt.toString(e);case"utf16":case"utf16be":return P.toString(e);case"utf16le":case"usc2":return P.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}static ToBinary(e){const t=b.toUint8Array(e);let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return r}static ToHex(e){const t=b.toUint8Array(e),r="",n=[],s=t.length;for(let o=0;o<s;o++){const a=t[o].toString(16).padStart(2,"0");n.push(a)}return n.join(r)}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!k.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let n=0;n<t.length;n=n+2){const s=t.slice(n,n+2);r[n/2]=parseInt(s,16)}return r.buffer}static ToUtf16String(e,t=!1){return P.toString(e,t)}static FromUtf16String(e,t=!1){return P.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}k.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function ve(i,e){let t=0;if(i.length===1)return i[0];for(let r=i.length-1;r>=0;r--)t+=i[i.length-1-r]*Math.pow(2,e*r);return t}function oe(i,e,t=-1){const r=t;let n=i,s=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(i<o){let l;if(r<0)l=new ArrayBuffer(a),s=a;else{if(r<a)return new ArrayBuffer(0);l=new ArrayBuffer(r),s=r}const u=new Uint8Array(l);for(let d=a-1;d>=0;d--){const h=Math.pow(2,d*e);u[s-d-1]=Math.floor(n/h),n-=u[s-d-1]*h}return l}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function Bt(...i){let e=0,t=0;for(const s of i)e+=s.length;const r=new ArrayBuffer(e),n=new Uint8Array(r);for(const s of i)n.set(s,t),t+=s.length;return n}function Zt(){const i=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=i[0]===255&&i[1]&128,l=i[0]===0&&(i[1]&128)===0;(a||l)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=i[0]&128;const r=ve(t,8),n=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(n);for(let a=0;a<this.valueHex.byteLength;a++)s[a]=i[a];return s[0]&=127,ve(s,8)-r}function yi(i){const e=i<0?i*-1:i;let t=128;for(let r=1;r<8;r++){if(e<=t){if(i<0){const o=t-e,a=oe(o,8,r),l=new Uint8Array(a);return l[0]|=128,a}let n=oe(e,8,r),s=new Uint8Array(n);if(s[0]&128){const o=n.slice(0),a=new Uint8Array(o);n=new ArrayBuffer(n.byteLength+1),s=new Uint8Array(n);for(let l=0;l<o.byteLength;l++)s[l+1]=a[l];s[0]=0}return n}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function mi(i,e){if(i.byteLength!==e.byteLength)return!1;const t=new Uint8Array(i),r=new Uint8Array(e);for(let n=0;n<t.length;n++)if(t[n]!==r[n])return!1;return!0}function F(i,e){const t=i.toString(10);if(e<t.length)return"";const r=e-t.length,n=new Array(r);for(let o=0;o<r;o++)n[o]="0";return n.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function et(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Et(i){let e=0,t=0;for(let n=0;n<i.length;n++){const s=i[n];e+=s.byteLength}const r=new Uint8Array(e);for(let n=0;n<i.length;n++){const s=i[n];r.set(new Uint8Array(s),t),t+=s.byteLength}return r.buffer}function G(i,e,t,r){return e instanceof Uint8Array?e.byteLength?t<0?(i.error="Wrong parameter: inputOffset less than zero",!1):r<0?(i.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-r<0?(i.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(i.error="Wrong parameter: inputBuffer has zero length",!1):(i.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class kt{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Et(this.items)}}const He=[new Uint8Array([1])],Xt="0123456789",we="",O=new ArrayBuffer(0),xt=new Uint8Array(0),Me="EndOfContent",Qt="OCTET STRING",qt="BIT STRING";function z(i){var e;return e=class extends i{constructor(...r){var n;super(...r);const s=r[0]||{};this.isHexOnly=(n=s.isHexOnly)!==null&&n!==void 0?n:!1,this.valueHexView=s.valueHex?b.toUint8Array(s.valueHex):xt}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(r){this.valueHexView=new Uint8Array(r)}fromBER(r,n,s){const o=r instanceof ArrayBuffer?new Uint8Array(r):r;if(!G(this,o,n,s))return-1;const a=n+s;return this.valueHexView=o.subarray(n,a),this.valueHexView.length?(this.blockLength=s,a):(this.warnings.push("Zero buffer length"),n)}toBER(r=!1){return this.isHexOnly?r?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",O)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:k.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class ae{constructor({blockLength:e=0,error:t=we,warnings:r=[],valueBeforeDecode:n=xt}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=b.toUint8Array(n)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:k.ToHex(this.valueBeforeDecodeView)}}}ae.NAME="baseBlock";class L extends ae{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}L.NAME="valueBlock";class er extends z(ae){constructor({idBlock:e={}}={}){var t,r,n,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?b.toUint8Array(e.valueHex):xt,this.tagClass=(r=e.tagClass)!==null&&r!==void 0?r:-1,this.tagNumber=(n=e.tagNumber)!==null&&n!==void 0?n:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",O}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const n=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,n[0]=t}return n.buffer}if(!this.isHexOnly){const n=oe(this.tagNumber,7),s=new Uint8Array(n),o=n.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let l=0;l<o-1;l++)a[l+1]=s[l]|128;a[o]=s[o-1]}return a.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=t|31,!e){const n=this.valueHexView;for(let s=0;s<n.length-1;s++)r[s+1]=n[s]|128;r[this.valueHexView.byteLength]=n[n.length-1]}return r.buffer}fromBER(e,t,r){const n=b.toUint8Array(e);if(!G(this,n,t,r))return-1;const s=n.subarray(t,t+r);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;const a=s[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let l=1,u=this.valueHexView=new Uint8Array(255),d=255;for(;s[l]&128;){if(u[l-1]=s[l]&127,l++,l>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(l===d){d+=255;const m=new Uint8Array(d);for(let x=0;x<u.length;x++)m[x]=u[x];u=this.valueHexView=new Uint8Array(d)}}this.blockLength=l+1,u[l-1]=s[l]&127;const h=new Uint8Array(l);for(let m=0;m<l;m++)h[m]=u[m];u=this.valueHexView=new Uint8Array(l),u.set(h),this.blockLength<=9?this.tagNumber=ve(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}er.NAME="identificationBlock";class tr extends ae{constructor({lenBlock:e={}}={}){var t,r,n;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(r=e.longFormUsed)!==null&&r!==void 0?r:!1,this.length=(n=e.length)!==null&&n!==void 0?n:0}fromBER(e,t,r){const n=b.toUint8Array(e);if(!G(this,n,t,r))return-1;const s=n.subarray(t,t+r);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;const o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,l=n.subarray(a,a+o);return l[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=ve(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const n=oe(this.length,8);if(n.byteLength>127)return this.error="Too big length",O;if(t=new ArrayBuffer(n.byteLength+1),e)return t;const s=new Uint8Array(n);r=new Uint8Array(t),r[0]=n.byteLength|128;for(let o=0;o<n.byteLength;o++)r[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}tr.NAME="lengthBlock";const f={};class V extends ae{constructor({name:e=we,optional:t=!1,primitiveSchema:r,...n}={},s){super(n),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new er(n),this.lenBlock=new tr(n),this.valueBlock=s?new s(n):new L(n)}fromBER(e,t,r){const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return n===-1?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}toBER(e,t){const r=t||new kt;t||rr(this);const n=this.idBlock.toBER(e);if(r.write(n),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;const o=this.lenBlock.toBER(e);r.write(o),r.write(s)}return t?O:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():k.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${k.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),r=e.toBER();return mi(t,r)}}V.NAME="BaseBlock";function rr(i){if(i instanceof f.Constructed)for(const e of i.valueBlock.value)rr(e)&&(i.lenBlock.isIndefiniteForm=!0);return!!i.lenBlock.isIndefiniteForm}class nr extends V{constructor({value:e=we,...t}={},r){super(t,r),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,r){const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return n===-1?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}nr.NAME="BaseStringBlock";class ir extends z(L){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}ir.NAME="PrimitiveValueBlock";var sr;class or extends V{constructor(e={}){super(e,ir),this.idBlock.isConstructed=!1}}sr=or,f.Primitive=sr,or.NAME="PRIMITIVE";function pi(i,e){if(i instanceof e)return i;const t=new e;return t.idBlock=i.idBlock,t.lenBlock=i.lenBlock,t.warnings=i.warnings,t.valueBeforeDecodeView=i.valueBeforeDecodeView,t}function At(i,e=0,t=i.length){const r=e;let n=new V({},L);const s=new ae;if(!G(s,i,e,t))return n.error=s.error,{offset:-1,result:n};if(!i.subarray(e,e+t).length)return n.error="Zero buffer length",{offset:-1,result:n};let a=n.idBlock.fromBER(i,e,t);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),a===-1)return n.error=n.idBlock.error,{offset:-1,result:n};if(e=a,t-=n.idBlock.blockLength,a=n.lenBlock.fromBER(i,e,t),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),a===-1)return n.error=n.lenBlock.error,{offset:-1,result:n};if(e=a,t-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};let l=V;switch(n.idBlock.tagClass){case 1:if(n.idBlock.tagNumber>=37&&n.idBlock.isHexOnly===!1)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};l=f.EndOfContent;break;case 1:l=f.Boolean;break;case 2:l=f.Integer;break;case 3:l=f.BitString;break;case 4:l=f.OctetString;break;case 5:l=f.Null;break;case 6:l=f.ObjectIdentifier;break;case 10:l=f.Enumerated;break;case 12:l=f.Utf8String;break;case 13:l=f.RelativeObjectIdentifier;break;case 14:l=f.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:l=f.Sequence;break;case 17:l=f.Set;break;case 18:l=f.NumericString;break;case 19:l=f.PrintableString;break;case 20:l=f.TeletexString;break;case 21:l=f.VideotexString;break;case 22:l=f.IA5String;break;case 23:l=f.UTCTime;break;case 24:l=f.GeneralizedTime;break;case 25:l=f.GraphicString;break;case 26:l=f.VisibleString;break;case 27:l=f.GeneralString;break;case 28:l=f.UniversalString;break;case 29:l=f.CharacterString;break;case 30:l=f.BmpString;break;case 31:l=f.DATE;break;case 32:l=f.TimeOfDay;break;case 33:l=f.DateTime;break;case 34:l=f.Duration;break;default:{const u=n.idBlock.isConstructed?new f.Constructed:new f.Primitive;u.idBlock=n.idBlock,u.lenBlock=n.lenBlock,u.warnings=n.warnings,n=u}}break;case 2:case 3:case 4:default:l=n.idBlock.isConstructed?f.Constructed:f.Primitive}return n=pi(n,l),a=n.fromBER(i,e,n.lenBlock.isIndefiniteForm?t:n.lenBlock.length),n.valueBeforeDecodeView=i.subarray(r,r+n.blockLength),{offset:a,result:n}}function vi(i,e){return i?1:e}class X extends L{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const n=b.toUint8Array(e);if(!G(this,n,t,r))return-1;if(this.valueBeforeDecodeView=n.subarray(t,t+r),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;vi(this.isIndefiniteForm,r)>0;){const o=At(n,s,r);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,r-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===Me)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Me?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const r=t||new kt;for(let n=0;n<this.value.length;n++)this.value[n].toBER(e,r);return t?O:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}X.NAME="ConstructedValueBlock";var ar;class be extends V{constructor(e={}){super(e,X),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const n=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return n===-1?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){const e=[];for(const r of this.valueBlock.value)e.push(r.toString("ascii").split(`
`).map(n=>`  ${n}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}ar=be,f.Constructed=ar,be.NAME="CONSTRUCTED";class lr extends L{fromBER(e,t,r){return t}toBER(e){return O}}lr.override="EndOfContentValueBlock";var cr;class ur extends V{constructor(e={}){super(e,lr),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}cr=ur,f.EndOfContent=cr,ur.NAME=Me;var hr;class fr extends V{constructor(e={}){super(e,L),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const n=new Uint8Array(r);n[0]=5,n[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}hr=fr,f.Null=hr,fr.NAME="NULL";class dr extends z(L){constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=b.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,r){const n=b.toUint8Array(e);return G(this,n,t,r)?(this.valueHexView=n.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Zt.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}dr.NAME="BooleanValueBlock";var gr;class yr extends V{constructor(e={}){super(e,dr),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}gr=yr,f.Boolean=gr,yr.NAME="BOOLEAN";class mr extends z(X){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let n=0;if(this.isConstructed){if(this.isHexOnly=!1,n=X.prototype.fromBER.call(this,e,t,r),n===-1)return n;for(let s=0;s<this.value.length;s++){const o=this.value[s].constructor.NAME;if(o===Me){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==Qt)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=super.fromBER(e,t,r),this.blockLength=r;return n}toBER(e,t){return this.isConstructed?X.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}mr.NAME="OctetStringValueBlock";var pr;class le extends V{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,s;(n=r.isConstructed)!==null&&n!==void 0||(r.isConstructed=!!(!((s=r.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},mr),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,r===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(s.byteLength){const o=At(s,0,s.byteLength);o.offset!==-1&&o.offset===r&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,r)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?be.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${k.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof le&&e.push(t.valueBlock.valueHexView);return b.concat(e)}}pr=le,f.OctetString=pr,le.NAME=Qt;class vr extends z(X){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let n=-1;if(this.isConstructed){if(n=X.prototype.fromBER.call(this,e,t,r),n===-1)return n;for(const a of this.value){const l=a.constructor.NAME;if(l===Me){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(l!==qt)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const u=a.valueBlock;if(this.unusedBits>0&&u.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=u.unusedBits}return n}const s=b.toUint8Array(e);if(!G(this,s,t,r))return-1;const o=s.subarray(t,t+r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const l=At(a,0,a.byteLength);l.offset!==-1&&l.offset===r-1&&(this.value=[l.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+r}toBER(e,t){if(this.isConstructed)return X.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return O;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}vr.NAME="BitStringValueBlock";var wr;class tt extends V{constructor({idBlock:e={},lenBlock:t={},...r}={}){var n,s;(n=r.isConstructed)!==null&&n!==void 0||(r.isConstructed=!!(!((s=r.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},vr),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return be.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const n of t)e.push(n.toString(2).padStart(8,"0"));const r=e.join("");return`${this.constructor.NAME} : ${r.substring(0,r.length-this.valueBlock.unusedBits)}`}}}wr=tt,f.BitString=wr,tt.NAME=qt;var br;function wi(i,e){const t=new Uint8Array([0]),r=new Uint8Array(i),n=new Uint8Array(e);let s=r.slice(0);const o=s.length-1,a=n.slice(0),l=a.length-1;let u=0;const d=l<o?o:l;let h=0;for(let m=d;m>=0;m--,h++){switch(!0){case h<a.length:u=s[o-h]+a[l-h]+t[0];break;default:u=s[o-h]+t[0]}switch(t[0]=u/10,!0){case h>=s.length:s=Bt(new Uint8Array([u%10]),s);break;default:s[o-h]=u%10}}return t[0]>0&&(s=Bt(t,s)),s}function Br(i){if(i>=He.length)for(let e=He.length;e<=i;e++){const t=new Uint8Array([0]);let r=He[e-1].slice(0);for(let n=r.length-1;n>=0;n--){const s=new Uint8Array([(r[n]<<1)+t[0]]);t[0]=s[0]/10,r[n]=s[0]%10}t[0]>0&&(r=Bt(t,r)),He.push(r)}return He[i]}function bi(i,e){let t=0;const r=new Uint8Array(i),n=new Uint8Array(e),s=r.slice(0),o=s.length-1,a=n.slice(0),l=a.length-1;let u,d=0;for(let h=l;h>=0;h--,d++)switch(u=s[o-d]-a[l-d]-t,!0){case u<0:t=1,s[o-d]=u+10;break;default:t=0,s[o-d]=u}if(t>0)for(let h=o-l+1;h>=0;h--,d++)if(u=s[o-d]-t,u<0)t=1,s[o-d]=u+10;else{t=0,s[o-d]=u;break}return s.slice()}class St extends z(L){constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Zt.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(yi(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,n=0){const s=this.fromBER(e,t,r);if(s===-1)return s;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):n!==0&&o.length<n&&(n-o.length>1&&(n=o.length+1),this.valueHexView=o.subarray(n-o.length)),s}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,r){const n=super.fromBER(e,t,r);return n===-1||this.setValueHex(),n}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),r=0,n;const s=this.valueHexView;let o="",a=!1;for(let l=s.byteLength-1;l>=0;l--){n=s[l];for(let u=0;u<8;u++){if((n&1)===1)switch(r){case e:t=bi(Br(r),t),o="-";break;default:t=wi(t,Br(r))}r++,n>>=1}}for(let l=0;l<t.length;l++)t[l]&&(a=!0),a&&(o+=Xt.charAt(t[l]));return a===!1&&(o+=Xt.charAt(0)),o}}br=St,St.NAME="IntegerValueBlock",Object.defineProperty(br.prototype,"valueHex",{set:function(i){this.valueHexView=new Uint8Array(i),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Er;class H extends V{constructor(e={}){super(e,St),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return et(),BigInt(this.valueBlock.toString())}static fromBigInt(e){et();const t=BigInt(e),r=new kt,n=t.toString(16).replace(/^-/,""),s=new Uint8Array(k.FromHex(n));if(t<0){const a=new Uint8Array(s.length+(s[0]&128?1:0));a[0]|=128;const u=BigInt(`0x${k.ToHex(a)}`)+t,d=b.toUint8Array(k.FromHex(u.toString(16)));d[0]|=128,r.write(d)}else s[0]&128&&r.write(new Uint8Array([0])),r.write(s);return new H({valueHex:r.final()})}convertToDER(){const e=new H({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new H({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}Er=H,f.Integer=Er,H.NAME="INTEGER";var kr;class xr extends H{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}kr=xr,f.Enumerated=kr,xr.NAME="ENUMERATED";class Nt extends z(L){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const n=b.toUint8Array(e);if(!G(this,n,t,r))return-1;const s=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let a=0;a<r&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ve(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){et();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let n=0;n<r.length;n++)r[n]=parseInt(t.slice(n*7,n*7+7),2)+(n+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const n=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=n[o]|128;return s[this.blockLength-1]=n[this.blockLength-1],s.buffer}const t=oe(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",O;const r=new Uint8Array(t.byteLength);if(!e){const n=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)r[o]=n[o]|128;r[s]=n[s]}return r}toString(){let e="";if(this.isHexOnly)e=k.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Nt.NAME="sidBlock";class Ar extends L{constructor({value:e=we,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){const s=new Nt;if(n=s.fromBER(e,n,r),n===-1)return this.blockLength=0,this.error=s.error,n;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,r-=s.blockLength,this.value.push(s)}return n}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const n=this.value[r].toBER(e);if(n.byteLength===0)return this.error=this.value[r].error,O;t.push(n)}return Et(t)}fromString(e){this.value=[];let t=0,r=0,n="",s=!1;do if(r=e.indexOf(".",t),r===-1?n=e.substring(t):n=e.substring(t,r),t=r+1,s){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const l=parseInt(n,10);if(isNaN(l))return;o.valueDec=l+a,s=!1}else{const o=new Nt;if(n>Number.MAX_SAFE_INTEGER){et();const a=BigInt(n);o.valueBigInt=a}else if(o.valueDec=parseInt(n,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(r!==-1)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();r!==0&&(e=`${e}.`),t?(n=`{${n}}`,this.value[r].isFirstSid?e=`2.{${n} - 80}`:e+=n):e+=n}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Ar.NAME="ObjectIdentifierValueBlock";var Sr;class rt extends V{constructor(e={}){super(e,Ar),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Sr=rt,f.ObjectIdentifier=Sr,rt.NAME="OBJECT IDENTIFIER";class Vt extends z(ae){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(r===0)return t;const n=b.toUint8Array(e);if(!G(this,n,t,r))return-1;const s=n.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let a=0;a<r&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ve(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const n=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=n[o]|128;return s[this.blockLength-1]=n[this.blockLength-1],s.buffer}const t=oe(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",O;const r=new Uint8Array(t.byteLength);if(!e){const n=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)r[o]=n[o]|128;r[s]=n[s]}return r.buffer}toString(){let e="";return this.isHexOnly?e=k.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Vt.NAME="relativeSidBlock";class Nr extends L{constructor({value:e=we,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let n=t;for(;r>0;){const s=new Vt;if(n=s.fromBER(e,n,r),n===-1)return this.blockLength=0,this.error=s.error,n;this.blockLength+=s.blockLength,r-=s.blockLength,this.value.push(s)}return n}toBER(e,t){const r=[];for(let n=0;n<this.value.length;n++){const s=this.value[n].toBER(e);if(s.byteLength===0)return this.error=this.value[n].error,O;r.push(s)}return Et(r)}fromString(e){this.value=[];let t=0,r=0,n="";do{r=e.indexOf(".",t),r===-1?n=e.substring(t):n=e.substring(t,r),t=r+1;const s=new Vt;if(s.valueDec=parseInt(n,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(r!==-1);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let n=this.value[r].toString();r!==0&&(e=`${e}.`),t&&(n=`{${n}}`),e+=n}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Nr.NAME="RelativeObjectIdentifierValueBlock";var Vr;class Cr extends V{constructor(e={}){super(e,Nr),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Vr=Cr,f.RelativeObjectIdentifier=Vr,Cr.NAME="RelativeObjectIdentifier";var Ur;class ce extends be{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}Ur=ce,f.Sequence=Ur,ce.NAME="SEQUENCE";var Fr;class Lr extends be{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}Fr=Lr,f.Set=Fr,Lr.NAME="SET";class Ir extends z(L){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=we}toJSON(){return{...super.toJSON(),value:this.value}}}Ir.NAME="StringValueBlock";class Tr extends Ir{}Tr.NAME="SimpleStringValueBlock";class I extends nr{constructor({...e}={}){super(e,Tr)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,b.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}I.NAME="SIMPLE STRING";class Rr extends I{fromBuffer(e){this.valueBlock.valueHexView=b.toUint8Array(e);try{this.valueBlock.value=k.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=k.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(k.FromUtf8String(e)),this.valueBlock.value=e}}Rr.NAME="Utf8StringValueBlock";var Or;class ue extends Rr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}Or=ue,f.Utf8String=Or,ue.NAME="UTF8String";class Hr extends I{fromBuffer(e){this.valueBlock.value=k.ToUtf16String(e),this.valueBlock.valueHexView=b.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(k.FromUtf16String(e))}}Hr.NAME="BmpStringValueBlock";var Mr;class _r extends Hr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}Mr=_r,f.BmpString=Mr,_r.NAME="BMPString";class Dr extends I{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let n=0;n<t;n++){const s=oe(e.charCodeAt(n),8),o=new Uint8Array(s);if(o.length>4)continue;const a=4-o.length;for(let l=o.length-1;l>=0;l--)r[n*4+l+a]=o[l]}this.valueBlock.value=e}}Dr.NAME="UniversalStringValueBlock";var $r;class Pr extends Dr{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}$r=Pr,f.UniversalString=$r,Pr.NAME="UniversalString";var jr;class Kr extends I{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}jr=Kr,f.NumericString=jr,Kr.NAME="NumericString";var Jr;class Gr extends I{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}Jr=Gr,f.PrintableString=Jr,Gr.NAME="PrintableString";var zr;class Wr extends I{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}zr=Wr,f.TeletexString=zr,Wr.NAME="TeletexString";var Yr;class Zr extends I{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}Yr=Zr,f.VideotexString=Yr,Zr.NAME="VideotexString";var Xr;class Qr extends I{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}Xr=Qr,f.IA5String=Xr,Qr.NAME="IA5String";var qr;class en extends I{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}qr=en,f.GraphicString=qr,en.NAME="GraphicString";var tn;class Ct extends I{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}tn=Ct,f.VisibleString=tn,Ct.NAME="VisibleString";var rn;class nn extends I{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}rn=nn,f.GeneralString=rn,nn.NAME="GeneralString";var sn;class on extends I{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}sn=on,f.CharacterString=sn,on.NAME="CharacterString";var an;class Ut extends Ct{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let n=0;n<e.length;n++)this.valueBlock.valueHexView[n]=e.charCodeAt(n)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,b.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const r=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(r===null){this.error="Wrong input string for conversion";return}const n=parseInt(r[1],10);n>=50?this.year=1900+n:this.year=2e3+n,this.month=parseInt(r[2],10),this.day=parseInt(r[3],10),this.hour=parseInt(r[4],10),this.minute=parseInt(r[5],10),this.second=parseInt(r[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=F(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=F(this.month,2),t[2]=F(this.day,2),t[3]=F(this.hour,2),t[4]=F(this.minute,2),t[5]=F(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}an=Ut,f.UTCTime=an,Ut.NAME="UTCTime";var ln;class cn extends Ut{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t=!1,r="",n="",s=0,o,a=0,l=0;if(e[e.length-1]==="Z")r=e.substring(0,e.length-1),t=!0;else{const h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");r=e}if(t){if(r.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(r.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,m=r.indexOf("+"),x="";if(m===-1&&(m=r.indexOf("-"),h=-1),m!==-1){if(x=r.substring(m+1),r=r.substring(0,m),x.length!==2&&x.length!==4)throw new Error("Wrong input string for conversion");let S=parseInt(x.substring(0,2),10);if(isNaN(S.valueOf()))throw new Error("Wrong input string for conversion");if(a=h*S,x.length===4){if(S=parseInt(x.substring(2,4),10),isNaN(S.valueOf()))throw new Error("Wrong input string for conversion");l=h*S}}}let u=r.indexOf(".");if(u===-1&&(u=r.indexOf(",")),u!==-1){const h=new Number(`0${r.substring(u)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");s=h.valueOf(),n=r.substring(0,u)}else n=r;switch(!0){case n.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,u!==-1)throw new Error("Wrong input string for conversion");break;case n.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let h=60*s;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case n.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let h=60*s;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case n.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){const h=1e3*s;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}const d=o.exec(n);if(d===null)throw new Error("Wrong input string for conversion");for(let h=1;h<d.length;h++)switch(h){case 1:this.year=parseInt(d[h],10);break;case 2:this.month=parseInt(d[h],10);break;case 3:this.day=parseInt(d[h],10);break;case 4:this.hour=parseInt(d[h],10)+a;break;case 5:this.minute=parseInt(d[h],10)+l;break;case 6:this.second=parseInt(d[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(F(this.year,4)),t.push(F(this.month,2)),t.push(F(this.day,2)),t.push(F(this.hour,2)),t.push(F(this.minute,2)),t.push(F(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(F(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}ln=cn,f.GeneralizedTime=ln,cn.NAME="GeneralizedTime";var un;class hn extends ue{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}un=hn,f.DATE=un,hn.NAME="DATE";var fn;class dn extends ue{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}fn=dn,f.TimeOfDay=fn,dn.NAME="TimeOfDay";var gn;class yn extends ue{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}gn=yn,f.DateTime=gn,yn.NAME="DateTime";var mn;class pn extends ue{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}mn=pn,f.Duration=mn,pn.NAME="Duration";var vn;class wn extends ue{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}vn=wn,f.TIME=vn,wn.NAME="TIME";const Bi="1.2.840.10045.2.1",Ei="1.2.840.10045.1.1",ki="01",xi=i=>new ce({name:"fieldID",value:[new rt({name:"fieldType",value:Ei}),new H({name:"parameters",valueHex:new Uint8Array([0,...$(i.p)]).buffer})]}),Ai=i=>new ce({name:"curve",value:[new le({name:"a",valueHex:new Uint8Array($(i.a)).buffer}),new le({name:"b",valueHex:new Uint8Array($(i.b)).buffer}),new tt({optional:!0,name:"seed",valueHex:i.seed?new Uint8Array($(i.seed)).buffer:i.seed})]}),Si=i=>new ce({name:"ecParameters",value:[new H({name:"version",valueHex:new Uint8Array($(ki)).buffer}),xi(i),Ai(i),new le({name:"base",valueHex:new Uint8Array($(i.generator)).buffer}),new H({name:"order",valueHex:new Uint8Array([0,...$(i.n)]).buffer}),new H({optional:!0,name:"cofactor",valueHex:new Uint8Array($(i.h)).buffer})]}),Ni=i=>new ce({name:"algorithm",value:[new rt({name:"algorithm",value:Bi}),Si(i)]}),Vi=(i,e)=>new ce({name:"SubjectPublicKeyInfo",value:[Ni(i),new tt({name:"subjectPublicKey",valueHex:new Uint8Array($(e)).buffer})]});function Ci({p:i,a:e,b:t,seed:r,generator:n,n:s,h:o}){return a=>{const l=Vi({p:i,a:e,b:t,seed:r,generator:n,n:s,h:o},a);return $(l.toString("hex"))}}function Ui(i){const e=Ci(i);return t=>e(fi(qe(t)))}const Fi=Ui({p:"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF",a:"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC",b:"5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B",seed:"C49D360886E704936A6678E1139D26B7819F7E90",generator:"046B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C2964FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",n:"FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551",h:"01"});async function Li(i,e,t){const r=await window.crypto.subtle.importKey("raw",qe(e),{name:"ECDH",namedCurve:"P-256"},!0,[]),n=await window.crypto.subtle.deriveKey({name:"ECDH",public:r},i.privateKey,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),s=await window.crypto.subtle.exportKey("raw",t),o=await window.crypto.subtle.exportKey("raw",n),a=Re([new Uint8Array(o),new Uint8Array([0,0,0,1]),Fi(Oe(new Uint8Array(s)))]);return await window.crypto.subtle.digest("SHA-256",a)}const bn=new Uint32Array(256);for(let i=0;i<256;i++){let e=i;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e>>>=1;bn[i]=e}function Ii(i){let e=4294967295;const t=i.byteLength;for(let r=0;r<t;r++)e=bn[(e^i[r])&255]^e>>>8;return e^4294967295}function Bn(i,e){return i===e?"inputs":"default"}function En(i,e,t,r){if(window==null)throw new pe("`window` object not found. You cannot run this SDK outside of a browser environment.");if(!("fetch"in window))throw new pe("Your browser is outdated and does not support window.fetch(). Please upgrade it.");async function n(){try{const o=new URL(`${e}/apps/${t}?context=${r}`,i.keysUrl),a=await fetch(o,{method:"GET"});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const l=await a.json(),{headers:u}=a;return{...l,isDebugMode:u.get("X-Evervault-Inputs-Debug-Mode")==="true"}}catch(o){throw new ni("An error occurred while retrieving the apps key",{cause:o})}}async function s(o,a){try{const l=await fetch(`${i.apiUrl}/decrypt`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${o}`},body:JSON.stringify(a)});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}catch(l){throw new si("An error occurred while decrypting the data",{cause:l})}}return{getCageKey:n,decryptWithToken:s}}function Ti(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ft={exports:{}},Be=typeof Reflect=="object"?Reflect:null,kn=Be&&typeof Be.apply=="function"?Be.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},nt;Be&&typeof Be.ownKeys=="function"?nt=Be.ownKeys:Object.getOwnPropertySymbols?nt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:nt=function(e){return Object.getOwnPropertyNames(e)};function Ri(i){console&&console.warn&&console.warn(i)}var xn=Number.isNaN||function(e){return e!==e};function v(){v.init.call(this)}Ft.exports=v,Ft.exports.once=_i,v.EventEmitter=v,v.prototype._events=void 0,v.prototype._eventsCount=0,v.prototype._maxListeners=void 0;var An=10;function it(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(v,"defaultMaxListeners",{enumerable:!0,get:function(){return An},set:function(i){if(typeof i!="number"||i<0||xn(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");An=i}}),v.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},v.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||xn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Sn(i){return i._maxListeners===void 0?v.defaultMaxListeners:i._maxListeners}v.prototype.getMaxListeners=function(){return Sn(this)},v.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")kn(l,this,t);else for(var u=l.length,d=Fn(l,u),r=0;r<u;++r)kn(d[r],this,t);return!0};function Nn(i,e,t,r){var n,s,o;if(it(t),s=i._events,s===void 0?(s=i._events=Object.create(null),i._eventsCount=0):(s.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),s=i._events),o=s[e]),o===void 0)o=s[e]=t,++i._eventsCount;else if(typeof o=="function"?o=s[e]=r?[t,o]:[o,t]:r?o.unshift(t):o.push(t),n=Sn(i),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=i,a.type=e,a.count=o.length,Ri(a)}return i}v.prototype.addListener=function(e,t){return Nn(this,e,t,!1)},v.prototype.on=v.prototype.addListener,v.prototype.prependListener=function(e,t){return Nn(this,e,t,!0)};function Oi(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Vn(i,e,t){var r={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},n=Oi.bind(r);return n.listener=t,r.wrapFn=n,n}v.prototype.once=function(e,t){return it(t),this.on(e,Vn(this,e,t)),this},v.prototype.prependOnceListener=function(e,t){return it(t),this.prependListener(e,Vn(this,e,t)),this},v.prototype.removeListener=function(e,t){var r,n,s,o,a;if(it(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():Hi(r,s),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this},v.prototype.off=v.prototype.removeListener,v.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function Cn(i,e,t){var r=i._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?Mi(n):Fn(n,n.length)}v.prototype.listeners=function(e){return Cn(this,e,!0)},v.prototype.rawListeners=function(e){return Cn(this,e,!1)},v.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):Un.call(i,e)},v.prototype.listenerCount=Un;function Un(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}v.prototype.eventNames=function(){return this._eventsCount>0?nt(this._events):[]};function Fn(i,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=i[r];return t}function Hi(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function Mi(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function _i(i,e){return new Promise(function(t,r){function n(o){i.removeListener(e,s),r(o)}function s(){typeof i.removeListener=="function"&&i.removeListener("error",n),t([].slice.call(arguments))}Ln(i,e,s,{once:!0}),e!=="error"&&Di(i,n,{once:!0})})}function Di(i,e,t){typeof i.on=="function"&&Ln(i,"error",e,t)}function Ln(i,e,t,r){if(typeof i.on=="function")r.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function n(s){r.once&&i.removeEventListener(e,n),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var $i=Ft.exports;function Pi(i){const e=new $i.EventEmitter;return{async handleForm(t){var o;let r;const n=t.querySelectorAll("input"),s={};for(let a=0;a<n.length;a++){r=n[a];const{id:l,name:u,value:d}=r;if(l||u)if(r.hasAttribute("data-encrypt")){const h=await i.encrypt(d),m=document.createElement("input");m.type="hidden",m.value=h,m.setAttribute("data-evervault-created","yes"),l&&(m.id=l.replace("ev-hidden-","")),u&&(m.name=u.replace("ev-hidden-","")),t.appendChild(m),(o=r.id)!=null&&o.startsWith("ev-hidden-")&&(r.id=`ev-hidden-${l}`),r.name="",t[l||u].value=h,s[l?l.replace("ev-hidden-",""):u.replace("ev-hidden-","")]=h}else t[l||u].value=d,s[l||u]=d}return s},register(){const t=document.querySelectorAll("[data-evervault-form]");let r;t.length!=0&&console.error("Evervault Forms is no longer a supported Evervault product. This feature is not to beused in production code and will be removed in a future version. Please contact Evervault support if you see this message.");for(let n=0;n<t.length;n++){r=t[n];const s=r.onsubmit;r.onsubmit=async o=>{o.preventDefault();const a=await this.handleForm(r);if(this.events.emit("form-ready",a),r.getAttribute("data-evervault-form")==="auto")s?s():r.submit();else return!1}}},events:e}}const ji=i=>{var e;return((e=i.data)==null?void 0:e.type)==="EV_FRAME_HEIGHT"},In=i=>{var e;return((e=i.data)==null?void 0:e.type)==="EV_REVEAL_ERROR_EVENT"};function Ki(i){return{generate(e,t,r=!1,n=void 0,s=void 0){return document.getElementById(e).innerHTML=`<iframe src="${ui(i,r,t)}" id="ev-iframe" title="Payment details" frameborder="0" scrolling="0" height=${ai(t,r)} ${r?'width="100%"':""} allowTransparency="true" allow="clipboard-write"></iframe>`,window.addEventListener("message",a=>{a.origin===i.input.inputsOrigin&&(t==null?void 0:t.height)==="auto"&&ji(a)&&(document.getElementById(e).firstChild.height=a.data.height)}),{isInputsLoaded:new Promise((a,l)=>{window.addEventListener("message",u=>{var d,h,m,x;if(u.origin===i.input.inputsOrigin){if(((d=u.data)==null?void 0:d.type)==="EV_INPUTS_LOADED")if(r){if(!n)throw new Error("Request is required for Evervault Reveal");const S={cache:n.cache,credentials:n.credentials,destination:n.destination,integrity:n.integrity,keepalive:n.keepalive,method:n.method,mode:n.mode,referrer:n.referrer,referrerPolicy:n.referrerPolicy,url:n.url};n.headers instanceof Headers?S.headers=Object.fromEntries(n.headers.entries()):n.headers instanceof Object&&(S.headers=n.headers);const R=JSON.stringify(S),{customStyles:yt}=t,ws=new MessageChannel;(h=document.getElementById("ev-iframe").contentWindow)==null||h.postMessage({type:"revealRequestConfig",request:R,customStyles:yt},"*",[ws.port2])}else a(!0);else((m=u.data)==null?void 0:m.type)==="EV_REVEAL_COPY_EVENT"&&r&&s&&s();if(In(u)){const S=u.data.error;if(S)try{const R=JSON.parse(S);try{const yt=window[R.type];l(new yt(R.message))}catch{l(new Error(R.message))}}catch(R){l(`Failed to parse Error: ${R.message}, Unparsed: ${S}`)}}(((x=u.data)==null?void 0:x.type)==="EV_REVEAL_LOADED"||In(u))&&r&&a(!0)}})}),getData:()=>new Promise(a=>{var u;const l=new MessageChannel;l.port1.onmessage=({data:d})=>(l.port1.close(),a(d)),(u=document.getElementById("ev-iframe").contentWindow)==null||u.postMessage("message","*",[l.port2])}),on:(a,l)=>{a==="change"&&window.addEventListener("message",u=>{var d,h,m,x,S,R;u.origin===i.input.inputsOrigin&&((d=u.data)==null?void 0:d.type)!=="EV_FRAME_HEIGHT"&&((h=u.data)==null?void 0:h.type)!=="EV_INPUTS_LOADED"&&((m=u.data)==null?void 0:m.type)!=="EV_FRAME_READY"&&((x=u.data)==null?void 0:x.type)!=="EV_REVEAL_COPY_EVENT"&&((S=u.data)==null?void 0:S.type)!=="EV_REVEAL_LOADED"&&((R=u.data)==null?void 0:R.type)!=="EV_REVEAL_ERROR_EVENT"&&l(u.data)},!1)},setLabels:a=>{var u;const l=new MessageChannel;(u=document.getElementById("ev-iframe").contentWindow)==null||u.postMessage(a,"*",[l.port2])}}}}}function Tn(i){const e=new Uint8Array(i);if(window.crypto)return window.crypto.getRandomValues(e),e;throw new ri("Your browser is outdated and does not support the Web Crypto API. Please upgrade it.")}function Lt(i){return i.replace(/={1,2}$/,"")}async function Ji(i,e,t,r,n,s){const o=await window.crypto.subtle.exportKey("raw",r),a=Qe(o);return`ev:${s?"debug:":""}${i}${e!=="string"?`:${e}`:""}:${Lt(t)}:${Lt(Oe(a))}:${Lt(n)}:$`}async function Rn(i,e,t,r,n){const s=await window.crypto.subtle.exportKey("raw",e),o=Qe(s),a=new Uint8Array([37,69,86,69,78,67]),l=new Uint8Array([3]),u=new Uint8Array([55,0]),d=r?new Uint8Array([1]):new Uint8Array([0]),h=Re([a,l,u,o,i,d]),m=Re([h,new Uint8Array(t)]),x=Ii(m),S=new Uint8Array([x&255,x>>8&255,x>>16&255,x>>24&255]),R=Re([m,S]);return n!=null?new File([R],n,{type:"application/octet-stream"}):new Blob([R],{type:"application/octet-stream"})}const ct=class ct{constructor(e,t,r,n,s){g(this,st);g(this,ot);g(this,at);g(this,De);g(this,de);g(this,fe,void 0);g(this,Q,void 0);g(this,xe,void 0);g(this,M,void 0);g(this,q,void 0);y(this,fe,e),y(this,Q,t),y(this,xe,r),y(this,q,s),y(this,M,n)}async encrypt(e,t){if(!bt(e))throw new Error("Data must not be undefined");const r=/^[a-z0-9-]{1,20}$/;if(t!=null&&!r.test(t))throw new Error("The provided Data Role slug is invalid. The slug can be retrieved in the Evervault dashboard (Data Roles section).");if(ti(e))return B(this,at,Pn).call(this,e,t);if(Pt(e))return B(this,ot,$n).call(this,e,t);if(Xe(e))return B(this,de,Ze).call(this,[...e],t);if(Jt(e))return B(this,De,Mt).call(this,zt(e),Gt(e),t);throw new Error("The provided data to be encrypted is invalid.")}};fe=new WeakMap,Q=new WeakMap,xe=new WeakMap,M=new WeakMap,q=new WeakMap,st=new WeakSet,Dn=async function(e){let t=0;e==="number"?t=1:e==="boolean"&&(t=2);const r=1,n=await window.crypto.subtle.exportKey("raw",c(this,Q)),s=Qe(n),o=1,a=o+s.byteLength+c(this,fe).length,l=new Uint8Array(a),u=c(this,q)?128:0|t<<4|r;return l[0]=u,l.set(new Uint8Array(s),o),l.set(c(this,fe),o+s.byteLength),l.buffer},ot=new WeakSet,$n=async function(e,t){return B(this,de,Ze).call(this,{...e},t)},at=new WeakSet,Pn=async function(e,t){if(t!==void 0)throw new oi("Data roles are not supported for files.");if(e.size>c(this,M).maxFileSizeInBytes)throw new ii(`File size must be less than ${c(this,M).maxFileSizeInMB}MB`);const r=Tn(c(this,M).ivLength),n=await window.crypto.subtle.importKey("raw",c(this,xe),{name:"AES-GCM"},!0,["encrypt"]);return new Promise((s,o)=>{const a=new window.FileReader;a.onloadend=l=>{const u=a.result;if(u==null||typeof u=="string"){o({error:"Failed to read file to be encrypted"});return}window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:c(this,M).authTagLength,additionalData:c(this,fe)},n,u).then(d=>{e instanceof File?s(Rn(r,c(this,Q),d,c(this,q),e.name)):s(Rn(r,c(this,Q),d,c(this,q)))})},a.readAsArrayBuffer(e)})},De=new WeakSet,Mt=async function(e,t,r){var h;const n=Tn(c(this,M).ivLength),s=await window.crypto.subtle.importKey("raw",c(this,xe),{name:"AES-GCM"},!0,["encrypt"]),o=c(this,M).versions.BFS,a=B(h=ct,lt,jn).call(h,Math.floor(Date.now()/1e3),r),l=new Uint8Array(2);l[0]=a.length&255,l[1]=a.length>>8&255;const u=Re([l,a,hi(e)]),d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n,tagLength:c(this,M).authTagLength,additionalData:await B(this,st,Dn).call(this,t)},s,u);return Ji(o,t,Oe(n),c(this,Q),Oe(new Uint8Array(d)),c(this,q))},lt=new WeakSet,jn=function(e,t){const r=[];return r.push(128|(t?3:2)),t&&(r.push(162),r.push(...Array.from("dr").map(n=>n.charCodeAt(0))),r.push(160|t.length),r.push(...Array.from(t).map(n=>n.charCodeAt(0)))),r.push(162),r.push(...Array.from("eo").map(n=>n.charCodeAt(0))),r.push(5),r.push(162),r.push(...Array.from("et").map(n=>n.charCodeAt(0))),r.push(206),r.push(e>>24&255),r.push(e>>16&255),r.push(e>>8&255),r.push(e&255),new Uint8Array(r)},de=new WeakSet,Ze=async function(e,t){if(Jt(e))return B(this,De,Mt).call(this,zt(e),Gt(e),t);if(Pt(e)){const r={...e};for(const[n,s]of Object.entries(r))r[n]=await B(this,de,Ze).call(this,s,t);return r}if(Xe(e)){const r=[...e];return Promise.all(r.map(async n=>B(this,de,Ze).call(this,n,t)))}return e},g(ct,lt);let It=ct;function Gi(i){return e=>({styles:{body:{paddingBottom:2},label:{fontSize:14,marginBottom:4,display:"block",color:"#0a2540"},input:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"0 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1",boxShadow:"0px 1px 1px rgba(0, 0, 0, .03), 0px 3px 6px rgba(0, 0, 0, .02)","&::placeholder":{color:"#717f96"},"&:focus":{outline:"none",borderColor:"#63e"}},textarea:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"6px 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1",boxShadow:"0px 1px 1px rgba(0, 0, 0, .03), 0px 3px 6px rgba(0, 0, 0, .02)","&::placeholder":{color:"#717f96"},"&:focus":{outline:"none",borderColor:"#63e"}},select:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"6px 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1"},button:{fontSize:16,height:40,border:"1px solid #e6ebf1",padding:"0 12px"},".field[ev-valid=false] input":{color:"#df1c41",borderColor:"#df1c41"},".error":{color:"#df1c41",fontSize:"0.75rem",padding:"0.25rem 0"},"[ev-component=card]":{gap:16},"[ev-component=pin] input":{height:80,fontSize:20,caretColor:"transparent"},...i?e.extend(i):{}}})}function zi(i){return e=>({styles:{body:{paddingTop:4},".field":{position:"relative"},label:{top:10,left:8,zIndex:3,fontSize:14,lineHeight:1,height:"20px",display:"flex",color:"#717f96",padding:"0 4px",alignItems:"center",position:"absolute",pointerEvents:"none",transformOrigin:"center left",transition:"transform 150ms, background 150ms"},input:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"0 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1","&::placeholder":{color:"transparent"},"&:focus":{outline:"none",borderColor:"#63e"}},textarea:{height:40,fontSize:16,borderRadius:6,color:"#0a2540",padding:"6 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1","&::placeholder":{color:"transparent"},"&:focus":{outline:"none",borderColor:"#63e"}},".field[ev-valid=false] input":{color:"#df1c41",borderColor:"#df1c41"},".field:focus-within label, .field:not([ev-has-value=false]) label":{background:"white",transform:"translateY(-100%) scale(0.8)"},".error":{color:"#df1c41",fontSize:"0.75rem",padding:"0.25rem 0"},".field:not([ev-valid=false]):focus-within label":{color:"#63e"},".field[ev-valid=false] label":{color:"#df1c41"},".field[ev-has-value=true][ev-valid=true]:not(:focus-within) label":{color:"#0a2540"},"[ev-component=card]":{gap:16},...i?e.extend(i):{}}})}function Wi(i){return e=>({styles:{body:{paddingBottom:2},label:{fontSize:14,marginBottom:"0.5rem",color:"#0a2540",display:"none"},".field:first-child label":{display:"block"},"fieldset[ev-valid=false]":{paddingBottom:"1.5rem"},input:{height:40,fontSize:16,borderRadius:0,color:"#0a2540",padding:"0 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1",boxShadow:"0px 1px 1px rgba(0, 0, 0, .03), 0px 3px 6px rgba(0, 0, 0, .02)","&::placeholder":{color:"#717f96"},"&:focus":{outline:"none",borderColor:"#63e"}},textarea:{height:40,fontSize:16,borderRadius:0,color:"#0a2540",padding:"6 12px",backgroundColor:"#fff",border:"1px solid #e6ebf1",boxShadow:"0px 1px 1px rgba(0, 0, 0, .03), 0px 3px 6px rgba(0, 0, 0, .02)","&::placeholder":{color:"#717f96"},"&:focus":{outline:"none",borderColor:"#63e"}},".field[ev-valid=false] input":{color:"#df1c41",borderColor:"#df1c41"},".error":{color:"#df1c41",fontSize:"0.75rem",padding:"0.25rem 0",position:"absolute",left:0,bottom:0,display:"none"},".field[ev-valid=false]":{zIndex:4},".field:focus-within":{zIndex:5},"[ev-component=card]":{gap:0,"& .field[ev-valid=false]:nth-child(1) .error":{display:"block"},"& [ev-valid=true]:nth-child(1) + [ev-valid=false] .error":{display:"block"},"& [ev-valid=true]:nth-child(1) + [ev-valid=true]:nth-child(2) + [ev-valid=false] .error":{display:"block"},"& [ev-valid=true]:nth-child(1) + [ev-valid=true]:nth-child(2) + [ev-valid=true]:nth-child(3) + [ev-valid=false] .error":{display:"block"},"& .field:not(:last-child)":{marginBottom:"-1px"},"& .field:first-child":{"& input":{borderTopLeftRadius:6,borderTopRightRadius:6}},"& .field:last-child":{"& input":{borderBottomRightRadius:6,borderBottomLeftRadius:6}}},"[ev-component=card][ev-fields*=cvc][ev-fields*=expiry]":{"& .field[ev-name=expiry]":{"& input":{borderBottomLeftRadius:6}},"& .field[ev-name=cvc]":{marginLeft:"-1px","& input":{borderBottomLeftRadius:0}}},"[ev-component=pin]":{gap:0,"& input":{height:60},"& .field:not(:first-child)":{marginLeft:"-1px"},"& .field:first-child input":{borderTopLeftRadius:6,borderBottomLeftRadius:6},"& .field:last-child input":{borderTopRightRadius:6,borderBottomRightRadius:6}},...i?e.extend(i):{}}})}const Yi=Object.freeze(Object.defineProperty({__proto__:null,clean:Gi,material:zi,minimal:Wi},Symbol.toStringTag,{value:"Module"}));class Ee{constructor(){g(this,Ae,new EventTarget)}on(e,t){if(typeof t!="function")throw new Error("callback must be a function");const r=n=>{t(n.detail)};return c(this,Ae).addEventListener(e,r),()=>{c(this,Ae).removeEventListener(e,r)}}dispatch(e,t){const r=new CustomEvent(e,{detail:t});c(this,Ae).dispatchEvent(r)}}Ae=new WeakMap;var Zi=function(e){return Xi(e)&&!Qi(e)};function Xi(i){return!!i&&typeof i=="object"}function Qi(i){var e=Object.prototype.toString.call(i);return e==="[object RegExp]"||e==="[object Date]"||ts(i)}var qi=typeof Symbol=="function"&&Symbol.for,es=qi?Symbol.for("react.element"):60103;function ts(i){return i.$$typeof===es}function rs(i){return Array.isArray(i)?[]:{}}function _e(i,e){return e.clone!==!1&&e.isMergeableObject(i)?ke(rs(i),i,e):i}function ns(i,e,t){return i.concat(e).map(function(r){return _e(r,t)})}function is(i,e){if(!e.customMerge)return ke;var t=e.customMerge(i);return typeof t=="function"?t:ke}function ss(i){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(i).filter(function(e){return Object.propertyIsEnumerable.call(i,e)}):[]}function On(i){return Object.keys(i).concat(ss(i))}function Hn(i,e){try{return e in i}catch{return!1}}function os(i,e){return Hn(i,e)&&!(Object.hasOwnProperty.call(i,e)&&Object.propertyIsEnumerable.call(i,e))}function as(i,e,t){var r={};return t.isMergeableObject(i)&&On(i).forEach(function(n){r[n]=_e(i[n],t)}),On(e).forEach(function(n){os(i,n)||(Hn(i,n)&&t.isMergeableObject(e[n])?r[n]=is(n,t)(i[n],e[n],t):r[n]=_e(e[n],t))}),r}function ke(i,e,t){t=t||{},t.arrayMerge=t.arrayMerge||ns,t.isMergeableObject=t.isMergeableObject||Zi,t.cloneUnlessOtherwiseSpecified=_e;var r=Array.isArray(e),n=Array.isArray(i),s=r===n;return s?r?t.arrayMerge(i,e,t):as(i,e,t):_e(e,t)}ke.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(r,n){return ke(r,n,t)},{})};var ls=ke,cs=ls;const Tt=Ti(cs);class Mn{constructor(e,t={}){g(this,Ne);E(this,"object");E(this,"frame");g(this,$e,void 0);g(this,Se,{});this.object=B(this,Ne,mt).call(this,t),this.frame=e}update(e){this.object=B(this,Ne,mt).call(this,e)}get utilities(){return{media:this.media.bind(this),extend:this.extend.bind(this)}}extend(e){return y(this,$e,B(this,Ne,mt).call(this,e)),{}}media(e,t){const r=window.matchMedia(e),n=s=>{c(this,Se)[e].matches=s.matches,this.frame.update()};return r.addEventListener("change",n),c(this,Se)[e]={styles:t,matches:r.matches},{}}compile(){const e=c(this,$e),r=Object.values(c(this,Se)).filter(o=>o.matches).reduce((o,a)=>Tt(o,a.styles),{}),n=Tt(this.object,e??{});return{...n,styles:Tt(n.styles||{},r)}}}$e=new WeakMap,Se=new WeakMap,Ne=new WeakSet,mt=function(e){return typeof e=="function"?e(this.utilities):e};function _n(i=10){return Math.random().toString(36).substring(2,i+2)}function us(i){if(typeof i=="string"){const e=document.querySelector(i);if(!e)throw new Error(`Element with selector ${i} not found`);return e}return i}class he{constructor(e,t,r){g(this,ut);g(this,ht);E(this,"iframe");E(this,"payload");g(this,W,_n());g(this,Y,null);g(this,ge,void 0);g(this,Pe,!1);g(this,je,void 0);y(this,ge,e),this.iframe=document.createElement("iframe"),this.iframe.id=c(this,W),this.iframe.src=B(this,ut,Kn).call(this,t),this.iframe.dataset.evervault="component",this.iframe.style.height="0",this.iframe.style.border="none",this.iframe.style.width="100%",this.iframe.style.display="block",r!=null&&r.size&&this.setSize(r.size),this.iframe.setAttribute("ev-component",t),r!=null&&r.allow&&(this.iframe.allow=r.allow)}setSize(e){y(this,je,e),this.iframe.style.width=e.width,this.iframe.style.height=e.height}mount(e,t={}){if(this.isMounted)throw new Error("Evervault frame already mounted");const r=us(e);return y(this,Y,t.theme?new Mn(this,t.theme):null),this.on("EV_FRAME_HANDSHAKE",()=>{var n;B(this,ht,Jn).call(this),this.send("EV_INIT",{theme:(n=c(this,Y))==null?void 0:n.compile(),config:t.config})}),this.on("EV_FRAME_READY",()=>{y(this,Pe,!0)}),this.iframe.onerror=t.onError??null,r.appendChild(this.iframe),this}unmount(){this.iframe.remove();const e=document.getElementById(`ev-modal-${c(this,W)}`);return e==null||e.remove(),this}createOverlay(){const e=document.createElement("div");return e.id=`ev-modal-${c(this,W)}`,e.style.position="fixed",e.style.inset="0px",e.style.zIndex="9999",document.body.appendChild(e),e}update(e){var t,r;return e!=null&&e.theme&&(c(this,Y)?(t=c(this,Y))==null||t.update(e.theme):y(this,Y,new Mn(this,e.theme))),c(this,Pe)?(this.send("EV_UPDATE",{theme:(r=c(this,Y))==null?void 0:r.compile(),config:e==null?void 0:e.config}),this):this}on(e,t){const r=n=>{n.data.frame===c(this,W)&&n.data.type===e&&t(n.data.payload)};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)}once(e,t){const r=n=>{n.data.frame===c(this,W)&&n.data.type===e&&(t(n.data.payload),window.removeEventListener("message",r))};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)}send(e,t){var n;if(!this.iframe.contentWindow)return;const r={type:e,payload:t};(n=this.iframe.contentWindow)==null||n.postMessage(r,this.url)}get isMounted(){return!!this.iframe.parentNode}get url(){return c(this,ge).config.components.url}}W=new WeakMap,Y=new WeakMap,ge=new WeakMap,Pe=new WeakMap,je=new WeakMap,ut=new WeakSet,Kn=function(e){const t=new URL(this.url);return t.searchParams.set("id",c(this,W)),t.searchParams.set("app",c(this,ge).config.appId),t.searchParams.set("team",c(this,ge).config.teamId),t.searchParams.set("component",e),t.toString()},ht=new WeakSet,Jn=function(){this.on("EV_RESIZE",({height:e})=>{!this.iframe||c(this,je)||(this.iframe.style.height=`${e}px`)})};class hs{constructor(e,t){E(this,"values");g(this,C,void 0);g(this,T,void 0);g(this,j,new Ee);y(this,C,t??{}),y(this,T,new he(e,"Card")),c(this,T).on("EV_CHANGE",r=>{this.values=r,c(this,j).dispatch("change",r)}),c(this,T).on("EV_COMPLETE",r=>{c(this,j).dispatch("complete",r)}),c(this,T).on("EV_SWIPE",r=>{c(this,j).dispatch("swipe",r)}),c(this,T).on("EV_FRAME_READY",()=>{c(this,j).dispatch("ready")}),this.values={card:{name:null,brand:null,localBrands:[],bin:null,lastFour:null,number:null,expiry:{month:null,year:null},cvc:null},isValid:!1,isComplete:!1,errors:null}}get config(){var e;return{theme:c(this,C).theme,config:{autoFocus:c(this,C).autoFocus,translations:c(this,C).translations,hiddenFields:(e=c(this,C).hiddenFields??[])==null?void 0:e.join(","),fields:c(this,C).fields,acceptedBrands:c(this,C).acceptedBrands,autoComplete:c(this,C).autoComplete,autoProgress:c(this,C).autoProgress}}}mount(e){return c(this,T).mount(e,{...this.config,onError:()=>{c(this,j).dispatch("error")}}),this}update(e){return e&&y(this,C,{...c(this,C),...e}),c(this,T).update(this.config),this}unmount(){return c(this,T).unmount(),this}on(e,t){return c(this,j).on(e,t)}validate(){return c(this,T).send("EV_VALIDATE"),c(this,T).once("EV_VALIDATED",e=>{this.values=e,c(this,j).dispatch("validate",e)}),this}}C=new WeakMap,T=new WeakMap,j=new WeakMap;class fs{constructor(e,t){g(this,Z,void 0);g(this,K,void 0);g(this,ee,new Ee);y(this,Z,t??{}),y(this,K,new he(e,"Form")),c(this,K).on("EV_FRAME_READY",()=>{c(this,ee).dispatch("ready")}),c(this,K).on("EV_ERROR",()=>{c(this,ee).dispatch("error")}),c(this,K).on("EV_SUBMITTED",()=>{c(this,ee).dispatch("submitted")})}get config(){return{theme:c(this,Z).theme,config:{formSubmissionUrl:c(this,Z).formSubmissionUrl,formUuid:c(this,Z).formUuid}}}mount(e){return c(this,K).mount(e,{...this.config,onError:()=>{c(this,ee).dispatch("error")}}),this}unmount(){return c(this,K).unmount(),this}update(e){return e&&y(this,Z,{...c(this,Z),...e}),c(this,K).update(this.config),this}on(e,t){return c(this,ee).on(e,t)}}Z=new WeakMap,K=new WeakMap,ee=new WeakMap;class ds{constructor(e,t){E(this,"values",{value:"",isComplete:!1});g(this,_,void 0);g(this,J,void 0);g(this,te,new Ee);y(this,_,t??{}),y(this,J,new he(e,"Pin")),c(this,J).on("EV_CHANGE",r=>{this.values=r,c(this,te).dispatch("change",r)}),c(this,J).on("EV_COMPLETE",r=>{this.values=r,c(this,te).dispatch("complete",r)}),c(this,J).on("EV_FRAME_READY",()=>{c(this,te).dispatch("ready")})}get config(){return{theme:c(this,_).theme,config:{length:Math.min(c(this,_).length??4,10),mode:c(this,_).mode??"numeric",autoFocus:c(this,_).autoFocus,inputType:c(this,_).inputType}}}mount(e){return c(this,J).mount(e,{...this.config,onError:()=>{c(this,te).dispatch("error")}}),this}unmount(){return c(this,J).unmount(),this}update(e){return e&&y(this,_,{...c(this,_),...e}),c(this,J).update(this.config),this}on(e,t){return c(this,te).on(e,t)}}_=new WeakMap,J=new WeakMap,te=new WeakMap;class gs{constructor(e,t,r,n){E(this,"path");E(this,"ready",!1);E(this,"options");g(this,Ke,void 0);g(this,re,void 0);g(this,Je,new Ee);this.path=r,y(this,Ke,e),this.options=n??{},y(this,re,new he(t,"RevealCopyButton",{allow:"clipboard-read; clipboard-write"})),c(this,re).on("EV_REVEAL_CONSUMER_READY",()=>{this.ready=!0,e.checkIfReady()}),c(this,re).on("EV_COPY",()=>{c(this,Je).dispatch("copy")})}mount(e){return c(this,re).mount(e,{theme:this.options.theme,config:{path:this.path,text:this.options.text,icon:this.options.icon,channel:c(this,Ke).channel,format:this.options.format}}),this}unmount(){return c(this,re).unmount(),this}on(e,t){return c(this,Je).on(e,t)}}Ke=new WeakMap,re=new WeakMap,Je=new WeakMap;class ys{constructor(e,t,r,n){E(this,"path");E(this,"ready",!1);g(this,Ge,void 0);g(this,ye,void 0);g(this,Ve,void 0);this.path=r,y(this,Ge,e),y(this,Ve,n??{}),y(this,ye,new he(t,"RevealText")),c(this,ye).on("EV_REVEAL_CONSUMER_READY",()=>{this.ready=!0,e.checkIfReady()})}mount(e){return c(this,ye).mount(e,{theme:c(this,Ve).theme,config:{path:this.path,channel:c(this,Ge).channel,format:c(this,Ve).format}}),this}unmount(){return c(this,ye).unmount(),this}}Ge=new WeakMap,ye=new WeakMap,Ve=new WeakMap;class ms{constructor(e,t){g(this,ft);g(this,dt);g(this,ze);E(this,"ready",!1);E(this,"channel");g(this,Ce,void 0);g(this,N,void 0);g(this,D,void 0);E(this,"consumers",[]);g(this,Ue,new Ee);this.channel=_n(),y(this,Ce,e),y(this,N,t),y(this,D,new he(e,"RevealRequest")),c(this,D).iframe.style.position="absolute",c(this,D).iframe.style.pointerEvents="none",c(this,D).iframe.style.opacity="0",B(this,ft,Gn).call(this).catch(console.error),c(this,D).on("EV_REVEAL_REQUEST_READY",()=>{this.ready=!0,this.checkIfReady()}),c(this,D).on("EV_ERROR",()=>{B(this,ze,_t).call(this)})}text(e,t){const r=new ys(this,c(this,Ce),e,t);return this.consumers.push(r),r}copyButton(e,t){const r=new gs(this,c(this,Ce),e,t);return this.consumers.push(r),r}unmount(){return this.consumers.forEach(e=>e.unmount()),c(this,D).unmount(),this}on(e,t){return c(this,Ue).on(e,t)}checkIfReady(){!this.ready||!this.consumers.every(t=>t.ready)||c(this,Ue).dispatch("ready")}}Ce=new WeakMap,N=new WeakMap,D=new WeakMap,Ue=new WeakMap,ft=new WeakSet,Gn=async function(){c(this,D).mount(document.body,{config:{channel:this.channel,request:await B(this,dt,zn).call(this)},onError:()=>{B(this,ze,_t).call(this)}})},dt=new WeakSet,zn=async function(){return{cache:c(this,N).cache,credentials:c(this,N).credentials,destination:c(this,N).destination,integrity:c(this,N).integrity,keepalive:c(this,N).keepalive,method:c(this,N).method,mode:c(this,N).mode,referrer:c(this,N).referrer,referrerPolicy:c(this,N).referrerPolicy,url:c(this,N).url,body:await c(this,N).text(),headers:Object.fromEntries(c(this,N).headers.entries())}},ze=new WeakSet,_t=function(){c(this,Ue).dispatch("error")};class ps{constructor(e,t,r){g(this,Te);g(this,gt);g(this,Fe,void 0);g(this,Le,void 0);g(this,ne,void 0);g(this,Ie,void 0);g(this,U,void 0);g(this,ie,new Ee);y(this,Fe,t),y(this,ne,r??{}),y(this,Le,!1),y(this,U,new he(e,"ThreeDSecure")),y(this,Ie,e),c(this,U).on("EV_SUCCESS",n=>{B(this,Te,pt).call(this,"success",n)}),c(this,U).on("EV_FAILURE",n=>{B(this,Te,pt).call(this,"failure",n)}),c(this,U).on("EV_CANCEL",()=>{B(this,Te,pt).call(this,"cancelled")}),c(this,U).on("EV_FRAME_READY",()=>{c(this,ie).dispatch("ready")}),c(this,U).on("EV_ERROR",n=>{this.unmount(),c(this,ie).dispatch("error",n),n&&console.error(n.message)})}get config(){return{theme:c(this,ne).theme,config:{session:c(this,Fe),size:c(this,ne).size,isOverlay:c(this,Le)}}}mount(e){const t=e??c(this,U).createOverlay();return e||(y(this,Le,!0),c(this,U).setSize({width:"100%",height:"100%"})),c(this,U).mount(t,{...this.config,onError:()=>{c(this,ie).dispatch("error",{code:"frame-load-error",message:"The iframe required to mount this component failed to load"})}}),this}update(e){return e&&y(this,ne,{...c(this,ne),...e}),c(this,U).update(this.config),this}unmount(){return c(this,U).unmount(),this}on(e,t){return c(this,ie).on(e,t)}}Fe=new WeakMap,Le=new WeakMap,ne=new WeakMap,Ie=new WeakMap,U=new WeakMap,ie=new WeakMap,Te=new WeakSet,pt=async function(e,t){await B(this,gt,Wn).call(this,e,t),c(this,ie).dispatch(e==="success"?"success":"failure"),this.unmount()},gt=new WeakSet,Wn=async function(e,t){const r=c(this,Ie).config.http.apiUrl;await fetch(`${r}/frontend/3ds/browser-sessions/${c(this,Fe)}`,{method:"PATCH",headers:{"X-Evervault-App-Id":c(this,Ie).config.appId,"Content-Type":"application/json"},body:JSON.stringify({outcome:e,cres:t??null})})};class vs{constructor(e){E(this,"client");E(this,"themes",Yi);this.client=e}card(e){return new hs(this.client,e)}pin(e){return new ds(this.client,e)}reveal(e){return new ms(this.client,e)}form(e){return new fs(this.client,e)}threeDSecure(e,t){return new ps(this.client,e,t)}}const Ot=class Ot{constructor(e,t,r={}){E(this,"forms");E(this,"config");E(this,"http");E(this,"input");g(this,We,void 0);g(this,Ye,void 0);E(this,"ui");var s;if(!se(e))throw new pe("teamId must be a string");if(!se(t))throw new pe("appId must be a string");y(this,We,r.isDebugMode===!0),this.config=$t(e,t,r==null?void 0:r.urls,r==null?void 0:r.publicKey);const n=Bn(((s=window==null?void 0:window.location)==null?void 0:s.origin)??"",this.config.input.inputsOrigin);this.http=En(this.config.http,this.config.teamId,this.config.appId,n),this.forms=Pi(this),this.forms.register(),this.input=Ki(this.config),y(this,Ye,this.loadKeys(r.appKey)),this.ui=new vs(this)}static async init(e,t,r={}){var l;if(!se(e))throw new pe("teamUuid must be a string");if(!se(t))throw new pe("appUuid must be a string");const n=$t(e,t,r==null?void 0:r.urls,r==null?void 0:r.publicKey),s=Bn(((l=window==null?void 0:window.location)==null?void 0:l.origin)??"",n.input.inputsOrigin),a=await En(n.http,n.teamId,n.appId,s).getCageKey();return new Ot(e,t,{...r,appKey:a})}getContext(e,t){return e===t?"inputs":"default"}async loadKeys(e){let t;this.config.encryption.publicKey?t=di(this.config.encryption.publicKey):this.isInDebugMode()?t=this.config.debugKey:e?t=e:t=await this.http.getCageKey();const r=await window.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveBits","deriveKey"]),n=await Li(r,t.ecdhP256KeyUncompressed,r.publicKey);return new It(qe(t.ecdhP256Key),r.publicKey,n,this.config.encryption,this.isInDebugMode())}async encrypt(e,t){return ei(e)?e:(await c(this,Ye)).encrypt(e,t)}inputs(e,t){return typeof t=="string"?this.input.generate(e,{theme:t}):this.input.generate(e,t??{})}reveal(e,t,r,n){return{isRevealLoaded:this.input.generate(e,{theme:"reveal",...r},!0,t,n).isInputsLoaded}}auto(e=[]){global.oldFetch||(global.oldFetch=global.fetch,global.fetch=async(t,r)=>{const{body:n}=r,s=Wt(t),o=Wt(window.location.hostname);if(s===o)try{const a=JSON.parse(n);for(const l of Object.keys(a))(e.length===0||e.includes(l))&&(a[l]=await this.encrypt(a[l]));r.body=JSON.stringify(a)}catch{}return global.oldFetch(t,r)})}decrypt(e,t){return this.http.decryptWithToken(e,t)}isInDebugMode(){return c(this,We)}};We=new WeakMap,Ye=new WeakMap;let Rt=Ot;return Rt});
